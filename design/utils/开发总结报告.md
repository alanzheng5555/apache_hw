# Apache_HW Utils 模块开发总结报告

## 项目概述
根据 readme.md 文件要求，开发了以下模块：
- Clock buffer
- Clock divider
- Clock mux
- Clock switch
- Clock gating cells
- Sync cell (2-level)
- Edge detector

## 已完成模块

### 1. Clock Buffer (clock_buffer.v)
- 简单时钟缓冲器
- 输入直接传递到输出
- 已通过仿真验证

### 2. Clock Divider (clock_divider.v)
- 可配置分频系数的时钟分频器
- 默认分频系数为2
- 包含复位功能
- 已通过仿真验证（分频系数为4时，输出周期为输入的4倍）

### 3. Clock Multiplexer (clock_mux.v)
- 多路时钟选择器
- 可配置输入数量
- 根据选择信号选择对应时钟
- 已通过仿真验证

### 4. Clock Switch (clock_switch.v)
- 双时钟切换器
- 根据使能信号在主备时钟间切换
- 已通过仿真验证

### 5. Clock Gating Cell (clock_gating.v)
- 时钟门控单元
- 通过使能信号控制时钟输出
- 包含复位功能
- 已通过仿真验证

### 6. Sync Cell (sync_cell.v)
- 两级同步器
- 用于跨时钟域信号同步
- 包含复位功能
- 已通过仿真验证

### 7. Edge Detector (edge_detector.v)
- 边沿检测器
- 检测正边沿、负边沿和任意边沿
- 已通过仿真验证

## 仿真环境

### 目录结构
```
design/utils/
├── rtl/                    # RTL源代码
│   ├── clock_buffer.v
│   ├── clock_divider.v
│   ├── clock_mux.v
│   ├── clock_switch.v
│   ├── clock_gating.v
│   ├── sync_cell.v
│   └── edge_detector.v
├── sim/                    # 仿真文件
│   ├── tb_clock_buffer.v
│   ├── tb_clock_divider.v
│   ├── tb_clock_mux.v
│   ├── tb_clock_switch.v
│   ├── tb_clock_gating.v
│   ├── tb_sync_cell.v
│   ├── tb_edge_detector.v
│   └── Makefile
└── readme.md
```

### 仿真工具
- 使用 Icarus Verilog (iverilog) 进行编译
- 使用 vvp 运行仿真
- 生成 VCD 波形文件用于调试

### Makefile 功能
- `make all` - 编译所有测试台
- `make simulate_all` - 运行所有仿真
- `make simulate_<module>` - 运行特定模块仿真
- `make clean` - 清理生成文件
- `make help` - 显示帮助信息

## 仿真结果
- 所有模块均已通过功能仿真验证
- Clock divider 仿真显示正确的分频功能
- Clock buffer 仿真显示正确的直通功能
- 其他模块也通过了基本功能验证

## 使用方法
1. 进入仿真目录: `cd ~/clawd/project/apache_hw/design/utils/sim/`
2. 编译所有测试台: `make all`
3. 运行所有仿真: `make simulate_all`
4. 运行特定仿真: `make simulate_clock_divider` (示例)
5. 查看波形: `gtkwave tb_clock_divider.vcd` (需要安装gtkwave)

## 验证状态
✓ 所有模块 RTL 设计完成
✓ 所有模块测试台编写完成
✓ 所有模块通过功能仿真
✓ Makefile 创建完成
✓ 仿真环境搭建完成